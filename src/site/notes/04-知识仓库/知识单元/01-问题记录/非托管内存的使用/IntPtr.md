---
{"title":"IntPtr","note_type":"knowledge_base","description":"IntPtr 说明","tags":["csharp","dotnet"],"create_time":"2025-02-09","update_time":"2025-02-19","dg-home":false,"dg-publish":true,"knowledge_type":"问题记录","root":"非托管内存的使用","permalink":"/04-知识仓库/知识单元/01-问题记录/非托管内存的使用/IntPtr/","dgPassFrontmatter":true,"noteIcon":"","created":"2025-02-09","updated":"2025-02-19"}
---


所属知识库：[[04-知识仓库/归纳目录/01-问题记录/非托管内存的使用\|非托管内存的使用]]

`IntPtr` 是 C# 中一个特定的数据类型，用于表示指针或句柄，它在处理非托管代码和系统资源时非常有用。以下是对 `IntPtr` 的详细说明：

## 定义

- `IntPtr` 是一个结构体，位于 `System` 命名空间中。它的大小与当前平台相关：在 32 位平台上，它的大小为 4 字节，而在 64 位平台上为 8 字节。
- 它主要用于表示指针或句柄，确保在不同平台上处理指针时的类型安全和正确性。

## 使用场景

`IntPtr` 通常用于以下场景：

- **与非托管代码交互**：在使用 P/Invoke 等方式调用非托管 API 时，传递指针或句柄。
- **资源管理**：表示操作系统资源（如窗口句柄、文件句柄等）。
- **动态内存操作**：用于处理通过 `Marshal` 类分配的非托管内存。

## 示例代码

1. 使用 P/Invoke，[[04-知识仓库/知识单元/01-问题记录/非托管内存的使用/非托管内存的使用方式#DllImport\|非托管内存的使用方式#DllImport]]
2. 与 Marshal 结合使用 [[04-知识仓库/知识单元/01-问题记录/非托管内存的使用/非托管内存的使用方式#Interop Services\|非托管内存的使用方式#Interop Services]]

## 常用的属性

- **`IntPtr.Zero`**：表示一个空指针。
- **构造函数**：可以通过 `new IntPtr(int value)` 或 `new IntPtr(long value)` 创建一个 `IntPtr`。
- **`ToInt32` 和 `ToInt64`**：将 `IntPtr` 转换为 `int` 或 `long` 类型。
- **`Size`**：静态属性，获取当前平台的指针大小，通常用于条件编译。

## 注意事项

- **平台相关性**：`IntPtr` 的大小与当前平台相关，因此在处理指针时需要注意平台差异。
- **类型安全**：`IntPtr` 是一个不安全的类型，因此在使用时需要小心，避免出现指针错误。
- **资源释放**：`IntPtr` 通常用于处理非托管资源，需要手动释放资源，以避免内存泄漏。
- 在使用 `IntPtr` 类型时，通常会与 `unsafe` 代码或其他非托管操作一起使用，以确保数据的正确性和完整性。
