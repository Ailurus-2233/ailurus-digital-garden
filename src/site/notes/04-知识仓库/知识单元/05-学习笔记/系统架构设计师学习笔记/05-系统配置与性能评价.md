---
{"title":"05-系统配置与性能评价","note_type":"knowledge_base","description":"选择 计算机结构、软件分类、存储器、Cache、流水线","tags":["软考","系统架构设计师"],"create_time":"2024-09-30","update_time":"2025-02-19","dg-home":false,"dg-publish":true,"aliase":null,"knowledge_type":"学习笔记","root":"系统架构设计师学习笔记","permalink":"/04-知识仓库/知识单元/05-学习笔记/系统架构设计师学习笔记/05-系统配置与性能评价/","dgPassFrontmatter":true,"noteIcon":"","created":"2024-09-30","updated":"2025-02-19"}
---


所属知识库：[[04-知识仓库/归纳目录/05-学习笔记/系统架构设计师学习笔记\|系统架构设计师学习笔记]]

## 1 概述

本章只会在**选择题**中着重考察，每年会出 3-4 分的题目，但是难度不大。需要重点关注的是，Cache 和流水线会出计算题。

1. **计算机系统层次结构**：
		- 计算机系统是一个硬件和软件的综合体，可以看作是按功能划分的多级层次结构。
		- 层次结构包括硬联逻辑级、微程序级、传统机器级、操作系统级、汇编语言级、高级语言级和应用语言级。
		- 每一级都有其特定的机器语言和翻译机制。
	1. **计算机硬件的组成**：
			- 硬件通常是指一切看得见、摸得到的设备实体。
			- 计算机最基本的组成框图包括存储器、输入设备、输出设备、控制器和运算器等。
	2. **计算机软件的分类**：
			- 计算机软件按照功能分为应用软件和系统软件两大类。
	3. **计算机系统结构的分类**：
			- 存储程序的概念是冯·诺依曼等人于 1946 年提出的。
			- Flynn 分类法根据指令流、数据流的多倍性特征对计算机系统进行分类，包括 SISD、SIMD、MISD 和 MIMD。
2. **存储器系统**：
		- 传统的存储器系统分为高速缓冲存储器（Cache）、主存和辅存三级。
		- 主存由 CPU 直接访问，辅存用于存放当前不需要立即使用的信息，Cache 用于存放当前最急需处理的程序和数据。
	1. **Cache 存储器**：
			- Cache 容量小但速度快，通过优化调度算法，系统性能会大大改善。
			- Cache 基本原理是基于程序的局部性原理，包括时间局部性和空间局部性。
			- 常见的映射方法有直接映射、全相联映射和组相联映射。
			- 替换算法包括随机算法、先进先出算法和近期最少使用算法。
	2. **网络存储技术**：
			- 主流的网络存储技术包括直接附加存储（DAS）、网络附加存储（NAS）和存储区域网络（SAN）。
			- DAS 通过 SCSI 电缆直接连服务器，NAS 通过网络接口与网络直连，SAN 通过专用交换机连接磁盘阵列与服务器的高速专用子网。
3. **输入输出系统**：
		- I/O 系统由 I/O 设备、I/O 接口（I/O 控制器）和 I/O 控制管理软件等组成。
		- I/O 系统的工作方式包括程序控制方式、程序中断方式、DMA 工作方式、通道方式和 I/O 处理机。
4. **总线**：
		- 总线是一组能为多个部件分时共享的公共信息传送线路。
		- 总线分类包括内部总线和外部总线，地址总线、数据总线和控制总线，并行总线和串行总线。
		- 总线的性能指标包括总线宽度、总线带宽、总线负载、总线分时复用和总线触发传输。
5. **指令系统**：
		- 指令系统是计算机系统中软件与硬件分界面的一个主要标志。
		- 复杂指令系统计算机（CISC）和精简指令系统计算机（RISC）的比较。
6. **流水线技术**：
		- 流水线技术通过并行硬件提高系统性能，把一项任务分解为若干项顺序执行的子任务。
		- 流水线工作原理、性能分析（执行时长、吞吐率、加速比和效率）以及多条流水线的情况。
7. **系统性能设计**：
		- 性能指标包括运算速度、CPI、MIPS 和 MFLOPS。
		- 系统性能调整方法包括阿姆达尔解决方案。
8. **系统性能评估**：
		- 性能评估的主要目的是为性能优化和调整提供参考。
		- 常用的评估方法包括时钟频率法、指令执行速度法、等效指令速度法、数据处理速率法、综合理论性能法和基准程序法。
		- 基准程序法是目前一致承认的测试系统性能的较好方法。

## 2 计算机系统测次结构

1. ==计算机系统的多级层次结构==：
		- 计算机系统是一个硬件和软件的综合体，可以看作是按功能划分的多级层次结构。这种结构的划分，有利于正确理解计算机系统的工作过程，明确软件、硬件在系统中的地位和作用。
2. ==层次结构的具体级别==：
		- **第 6 级：应用语言机器** 虚拟机器 应用语言 翻译 应用软件包
		- **第 5 级：高级语言机器** 虚拟机器 高级语言 翻译 编译程序
		- **第 4 级：汇编语言机器** 虚拟机器 汇编语言 翻译 汇编程序
		- **第 3 级：操作系统机器** 虚拟机器 作业控制语言等 部分解释 操作系统
		- **第 2 级：传统机器** 实际机器 机器指令语言 解释 微程序机器
		- **第 1 级：微指令系统** 实际机器 微指令系统 硬件直接执行
		- **第 0 级：硬联逻辑** 实际机器 硬联逻辑
3. ==各层次的具体功能==：
		- **硬联逻辑级**：计算机的内核，由门、触发器等逻辑电路组成。
		- **微程序级**：机器语言是微指令集，程序员用微指令编写的微程序一般直接由硬件执行。
		- **传统机器级**：机器语言是该机的指令集，程序员用机器指令编写的程序可以由微程序进行解释。
		- **操作系统级**：直接管理传统机器中的软硬件资源，又是传统机器的延伸。
		- **汇编语言级**：机器语言是汇编语言，完成汇编语言翻译的程序称为汇编程序。
		- **高级语言级**：机器语言是各种高级语言，通常用编译程序来完成高级语言翻译的工作。
		- **应用语言级**：机器语言是各种面向问题的应用语言，专门设计以满足某种用途。
4. ==计算机硬件的组成==
	- **硬件定义**：
			- 硬件通常是指一切看得见、摸得到的设备实体。
	- **计算机基本组成**：
			- 计算机最基本的组成框图包括存储器、输入设备、输出设备、控制器和运算器等。
			- 存储器分为主存储器和辅助存储器。
			- 主机包括 CPU（控制器和运算器）。
5. ==计算机软件的分类==
	- **软件分类**：
			- 计算机软件按照功能分为应用软件和系统软件两大类。
			- 应用软件是为了满足某种用途而专门设计的软件。
			- 系统软件用于管理和控制计算机硬件资源，支持应用软件的运行。
6. ==计算机系统结构的分类==
	- **存储程序的概念**：
			- 冯·诺依曼等人于 1946 年提出"存储程序"的概念。
			- 存储程序控制计算机的主要弱点是存储器访问会成为瓶颈。
			- 非冯·诺依曼型计算机包括数据驱动的数据流计算机、需求驱动的归约计算机和模式匹配驱动的智能计算等。
	- **Flynn 分类**：
			- 根据指令流、数据流的多倍性特征对计算机系统进行分类（Flynn 分类法）。
			- **SISD（单指令流单数据流）**：传统顺序执行的单处理器计算机或流水线方式的单处理机。
			- **SIMD（单指令流多数据流）**：并行处理机（矩阵处理机），多个重复的处理单元由单一指令部件控制。
			- **MISD（多指令流单数据流）**：有多个处理单元对同一数据流按不同指令处理，少见，流水线有时被视为 MISD。
			- **MIMD（多指令流多数据流）**：多机系统，能实现作业、任务、指令等各级全面并行，如高性能服务器与超级计算机。

## 3 存储器系统

传统的存储器系统一般分为**高速缓冲存储器(Cache)、主存、辅存三级**。主存可由 CPU 直接访问，存取速度快，但容量较小，一般用来存放当前正在执行的程序和数据。

**辅存设置在主机外部，它的存储容量大，价格较低，但存取速度较慢**，一般用来存放暂时不参与运行的程序和数据，CPU 不可以直接访问辅存，辅存中的程序和数据在需要时才传送到主存，因此它是主存的补充和后援。

主**存和 CPU 间增设了一级 Cache。Cache 的存取速度比主存更快，但容量更小，用来存放当前最急需处理的程序和数据**，以便快速地向 CPU 提供指令和数据。

**计算机采用多级存储器体系，确保能够获得尽可能高的存取速率，同时保持较低的成本。**

1. ==主存储器==
	- **主存储器定义**：主存用来存放计算机运行期间所需要的程序和数据，CPU 可直接随机地进行读/写。
	- **分类**：根据工艺和技术不同，主存可分为*随机存取存储器（RAM）和只读存储器（ROM）*。
2. ==辅助存储器==
	- **辅助存储器定义**：
			- 辅助存储器用于存放当前不需要立即使用的信息，一旦需要，再和主机成批交换数据，是主存储器的后备。
			- 辅助存储器又称为外存储器。
	- **特点**：
			- *存储容量大、可靠性高、价格低*。
			- CPU 不可以直接访问辅存，辅存中的程序和数据在需要时才传送到主存。
			- RAID 技术为缩小 CPU 速度与磁盘存储器速度差距，用多个小磁盘替换大磁盘，合理分布数据以支持多磁盘同时读写，从而提升系统/O 性能，现代表独立磁盘冗余阵列，强调其带来性能改善和更高可靠性。**RAID 机制中共分 8 个级别，RAD 应用的主要技术有分块技术、交叉技术和重聚技术。**
	- **常用类型**：磁带存储器、硬盘存储器、磁盘阵列和光盘存储器。
3. ==Cache 存储器==
	- **Cache 定义**：
		- Cache 容量小但速度快，内存速度较低但容量大，通过优化调度算法，系统的性能会大大改善。
		- Cache 通常采用相连存储器(CAM)。CAM 是一种基于数据内容进行访问的存储设备。
	- **基本原理**：使用 Cache 改善系统性能的依据是程序的局部性原理，包括时间局部性和空间局部性。
		- **时间局部性** 是指如果一个存储单元被访问，则可能该单元会很快被再次访问。这是因为程序存在着循环。
		- **空间局部性** 是指如果一个存储单元被访问，则该单元邻近的单元也可能很快被访问。这是因为程序中大部分指令是顺序存储、顺序执行的，数据一般也是以向量、数组、树、表等形式簇聚地存储在一起的。
		- **平均时间周期** 如果以 h 代表对 Cache 的访问命中率，l-h 称为失效率，或者称为未命中率)，t 表示 Cache 的周期时间，t2 表示内存的周期时间，以读操作为例，使用"Cache+主存储器"的系统的平均周期为 t3。则：$t_3 = t_1 \times h + t_2 \times (1 - h)$
	- **映射机制**：
			- 当 CPU 发出访存请求后，存储器地址先被送到 Cache 控制器以确定所需数据是否已在 Cache 中。
			- 常见的映射方法有直接映射、全相联映射和组相联映射。
	- **替换算法**：
			- 当 Cache 产生了一次访问未命中之后，相应的数据应同时读入 CPU 和 Cache。
			- 常用的替换算法有随机算法、先进先出算法（FIFO）和近期最少使用算法（LRU）。
4. ==网络存储技术==
	- **直接附加存储（DAS）**：
			- *通过 SCSI 电缆直接连服务器，是硬件堆叠，存储操作依赖服务器*。
			- 适用特定环境，但存在传递限制，难扩展，影响服务器性能，现基本被 NAS 替代。
	- **网络附加存储（NAS）**：
			- *存储设备通过网络接口与网络直连，类似专用文件服务器*。
			- 优化体系结构，以数据为中心，存储设备独立，响应快，传输率高，支持多种协议。
			- 适用于小文件级共享存取，可配置为文件服务器。
	- **存储区域网络（SAN）**：
			- *通过专用交换机连接磁盘阵列与服务器的高速专用子网，采用块级别存储*。
			- 存储设备从以太网分离，有 FCSAN、IPSAN、IBSAN。
			- 支持多操作系统，可分离存储和提供高可用性，能降低运营成本。

## 4 输入输出系统

I/O 系统由 **I/O 设备、I/O 接口（I/O 控制器）和 I/O 控制管理软件**等组成。

1. **输入输出方式**
	- ==程序控制方式==：
			- 由 CPU 执行一段 I/O 程序来实现主机与外设之间的数据传送。
			- 根据外设的不同性质，可分为无条件传送和程序查询方式两种。
	- ==程序中断方式==：
			- 为了提高 I/O 能力和 CPU 的效率，计算机系统引进了中断方式。
			- 程序中断是指计算机执行现行程序的过程中，出现某些急需处理的异常情况和特殊请求，CPU 暂时中止现行程序（保护现场），而转去对随机发生的更紧迫的事件进行处理，在处理完毕后，CPU 将自动返回原来的程序继续执行（恢复现场）。
	- ==DMA 工作方式==：
			- **DMA 工作方式是为了在主存与外设之间实现高速、批量数据交换而设置的，使用 DMA 控制器（DMAC）来控制和管理数据传输。**
	- ==通道方式==：
			- 通道是一种高级的 I/O 控制部件，利用软件手段实现对 I/O 的控制和传送，更多地免去了 CPU 的介入，从而使主机和外设的并行工作程度更高。
	- ==I/O 处理机==：
			- I/O 处理机也称为外围处理机，它是一个专用处理机，也可以是一个通用的处理机，具有丰富的指令系统和完善的中断系统。
2. **总线**
	- ==总线的定义==：
			- *总线是一组能为多个部件分时共享的公共信息传送线路。*
			- *共享是指总线上可以挂接多个部件*，各个部件之间相互交换的信息都可以通过这组公共线路传送。
			- *分时是指同一时刻只允许有一个部件向总线发送信息*。
			- *在同一时刻，允许多个部件同时从总线上接收信息*。
	- ==总线的分类==：
			- *按位置分类*：
					- 内部总线：CPU 内部，寄存器之间和算术逻辑部件 ALU 与控制部件之间传输数据所用的总线。
					- 外部总线：CPU 与内存 RAM、ROM 和输入/输出设备接口之间进行通信的通路。
			- *按功能分类*：
					- 地址总线：用来传送地址信息。
					- 数据总线：用来传送数据信息。
					- 控制总线：用来传送各种控制信号。
			- *按数据线多少分类*：
					- 并行总线：*数据传输速率高，适合近距离连接*，大多数的系统总线属于并行总线。
					- 串行总线：*数据传输速率低于并行总线*，大多数的通信总线属于串行总线。
	- ==总线的性能指标==：
			- *总线宽度*：总线的线数，决定了总线所占的物理空间和成本。
			- *总线带宽*：总线的最大数据传输速率，即每秒传输的字节。
					- $总线带宽 = 总线宽度 \times 总线频率$
					- 假设某系统总线在一个总线周期中并行传输 4B 信息，一个总线周期占用 2 个时钟周期，总线时钟频率为 10MHz。此时，时钟周期 T=1/10M =0.1µs，总线周期=2T=0.2µs，则总线带宽为 4/0.2=20MBps。
			- *总线负载*：连接在总线上的最大设备数量，大多数总线的负载能力是有限的。
			- *总线分时复用*：在不同时段利用总线上同一个信号线传送不同信号，例如，地址总线和数据总线共用一组信号线。
			- *总线触发传输*：一种总线传输方式，即在一个总线周期中可以传输存储地址连续的多个数据。

## 5 指令系统

1. **指令系统的定义**：
	- 指令是指计算机执行某些操作的命令，一台计算机的所有指令的集合构成指令系统，也称为指令集
	- 指令系统是计算机系统中软件与硬件分界面的一个主要标志。
2. **复杂指令系统计算机（CISC）**：
	- 采用复杂指令，一条指令可以实现多个操作，指令格式复杂，指令字长不等。
	- 优点是编程方便，编译程序简单，缺点是指令执行速度慢，硬件复杂，容易出错。
	- 指令数量多，使用频率差别大，可变长格式
	- 支持多种寻址方式
	- 采用微程序控制方式
	- 研制周期长，成本高
3. **精简指令系统计算机（RISC）**：
	- 采用精简指令，一条指令只能实现一个操作，指令格式简单，指令字长相等。
	- 优点是指令执行速度快，硬件简单，缺点是编程复杂，编译程序复杂。
	- 指令数量少，使用频率相近，固定格式，大部分是单周期指令、操作寄存器，只有 Load/Store 指令访问内存
	- 支持少量寻址方式
	- 增加了通用寄存器，硬布线逻辑控制为主；适合采用流水线
	- 优化编译，有效支持高级语言

## 6 ※流水线技术

要提高计算机系统的性能，增加并行性，可以从两个方面入手。**一个是空间并行性，即在一个处理机内设置多个独立的操作部件**，并让这些操作部件并行工作，这种处理机被称为超标量处理机。另**一个是时间并行性，也就是采用流水线技术**。流水线技术是通过并行硬件来提高系统性能的常用方法。**利用流水线技术，可以不增加硬件或只需要增加少量硬件，就能够把处理机的运算速度提高数倍。**

1. **流水线工作原理**
	- *流水线技术把一项任务分解为若干项顺序执行的子任务*
	- *不同的子任务由不同的操作部件负责执行，而这些部件可以同时并行工作。*
	- 在任一时刻，任一任务只占用其中一个操作部件，实现多项任务的重叠执行，提高工作效率。
2. **流水线性能分析**
	1. ==流水线执行时长==：
			- 公式：流水线执行时长 = 第一条指令顺序执行时间 + (指令条数 - 1) × 周期
			- *周期是流水线中各阶段中占最长时间的操作的时间*。
	2. ==吞吐率==：
			- 定义：在单位时间内流水线所完成的任务数量或输出的结果数量。
			- 公式：$TP = \frac{n}{T_k}$ 其中，n 为任务数，Tk 为处理完成 n 项任务所用的时间。
			- 如果流水线中各段的执行时间不完全相等：$TP = \frac{n}{\sum_{i=1}^{k} t_i + (n-1) \max(t_1, t_2, \ldots, t_k)}$
			- 最大吞吐率 $TP = \frac{1}{\max(t_1, t_2, \ldots, t_k)}$
			- **当流水线中各段的执行时间不完全相等时，吞吐率主要是由流水线中执行时间最长的那个功能段来决定的**
	3. ==加速比==：
			- 定义：顺序执行所用的时间 T₀ 与使用流水线的执行时间 Tₖ 之比。
			- 公式：$S = \frac{T_0}{T_k}$
			- 当流水线的各个流水段的执行时间不相等时：$S = \frac{n \sum_{i=1}^{k} t_i}{\sum_{i=1}^{k} t_i + (n-1) \max(t_1, t_2, \ldots, t_k)}$
			- 例如，某流水线浮点加法器分为 5 段，每一段所需时间分别为 6ns、7ns、8ns、9ns 和 6ns：$S = \frac{36n}{36 + 9(n-1)} = \frac{4n}{4 + n - 1}$
			- 最大加速比：$S_{\max} = \lim_{n \rightarrow \infty} \frac{4n}{4 + n - 1} = 4$
	4. ==效率==：
			- 定义：流水线的设备利用率，反映了流水线的忙碌状态。
			- 公式：$E = \frac{n \sum_{i=1}^{k} t_i}{k(\sum_{i=1}^{k} t_i + (n-1) \max(t_1, t_2, \ldots, t_k))}$
			- 当 n > k 时，流水线的效率达到最大值 1，流水线的各段均处于忙碌状态。
	5. ==多条流水线的情况==：
			- 例如，指令由取指、分析、执行 3 个子部件完成，每个子部件的时间均为 t。
			- 常规标量单流水线处理机，连续执行 12 条指令，共需(12 + 3 - 1)t = 14t。
			- 度为 4 的超标量流水线处理机，连续执行上述 12 条指令，只需(3 + 3 - 1)t = 5t。

## 7 系统性能设计

1. **性能指标**
	- ==运算速度==：
			- 计算机的运算速度与机器的主频、执行的操作类型以及主存的速度等因素有关。
	- ==CPI（每条指令执行所用的时钟周期数）==：
			- *CPI 是一个平均值*，反映了不同指令执行时间的差异。
			- 在现代高性能计算机中，由于并行技术的应用，常常在一个系统时钟周期内可以处理若干条指令。
			- *CPI 经常用 IPC（每个时钟周期执行的指令条数）来表示，IPC 等于 CPI 的倒数。*
	- ==MIPS（每秒百万条指令）==：
			- 定义为：`MIPS = 指令条数 / (执行时间 × 10⁶) = 主频 / CPI = 主频 × IPC`
	- ==MFLOPS（每秒百万次浮点运算）==：
			- 定义为：`MFLOPS = 浮点操作次数 / (执行时间 × 10⁶)`
2. **系统性能调整**  
	- ==阿姆达尔解决方案==：
		- *阿姆达尔定律*定义了采用特定组件所取得的加速比。
		- *加速比计算公式*：$R = \frac{T_p}{T_i}$ 其中，$T_p$ 表示不使用改进组件时完成整个任务的时间，$T_i$ 表示使用改进组件时完成整个任务的时间。
		- *加速比的两个主要因素*：
				- *改进比例（Fe）*：在原有系统上，能被改进的部分在总执行时间中所占的比例，$Fe$ 总是小于 1。
				- *性能提高（S）*：通过改进的执行方式所取得的性能提高，即整个系统使用改进执行方式后的执行速度提高的比例，$S$ 总大于 1。
				- 改进后整个系统的加速比公式：$R = \frac{1}{(1 - F_e + \frac{F_e}{S_e})}$
	- ==示例==：
		- 假设在某计算机系统中，某功能的处理时间为整个系统运行时间的 50%，若使该功能的处理速度加快 10 倍，则整个系统的性能提高倍数为：$R = \frac{1}{(1 - 0.5 + \frac{0.5}{10})} \approx 1.818$

## 8 系统性能评估

**系统性能评估的主要目的是为性能优化和调整提供参考，**而性能优化涉及的面很广，也很复杂。对于不同的应用系统，优化的方法也有所不同。与此相对应，性能评估的方法也有所不同。

1. 经典评估方法
	- **时钟频率法**: 通过测量计算机的时钟频率来评估其性能。
	- **指令执行速度法**：通过测量计算机执行指令的速度来评估其性能。
	- **等效指令速度法**：通过计算等效指令的执行速度来评估计算机性能。
	- **数据处理速率法**：通过测量计算机处理数据的速度来评估其性能。
	- **综合理论性能法**：通过综合多个性能指标来评估计算机的理论性能。
	- **基准程序法**：通过运行基准测试程序来评估计算机性能。
2. 基准程序法
	- **基准测试程序**：
			- 把应用程序中用得最多、最频繁的那部分核心程序作为评估计算机系统性能的标准程序。
			- 基准程序法是目前一致承认的测试系统性能的较好方法。

#### ​
