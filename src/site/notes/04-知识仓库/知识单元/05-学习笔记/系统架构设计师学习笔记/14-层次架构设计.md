---
{"dg-publish":true,"permalink":"/04//05//14/","title":"14-层次架构设计","tags":["软考","系统架构设计师"]}
---


所属知识库：[[04-知识仓库/归纳目录/05-学习笔记/系统架构设计师学习笔记\|系统架构设计师学习笔记]]

## 1 概述

本章是算比较重点的章节，只会在案例，论文中着重考察。案例方面，去年考察了层次结构里的 ORM 中 Hibernate 的基本架构所以还是需要引起重视，==本章的表现层，中间层，数据库访问层，物联网层次设计等都需要熟记。==

论文部分该主题也考察过多次，2016 年考察过《论数据访问层设计技术及其应用》，2013 年考察过《论企业应用系统的分层架构风格》，2012 年考察《论企业应用系统的数据持久层架构设计》。

**层次结构的概念**：
- 层次式体系结构设计将系统组成一个层次结构，每一层为上层服务，并作为下层客户。
- 层次系统内部的层接口只对相邻的层可见。
- 连接件通过协议定义层间交互，拓扑约束对相邻层间交互进行约束。
- 分层架构支持关注分离和软件重用。

**层次结构的设计原则**：
- 分层架构应避免"污水池反模式"，即请求简单地穿过各层而没有实质性的业务逻辑。
- 如果超过 20%的请求存在这种情况，应考虑让一些层变得更加开放。
- 分层架构可能会带来==应用庞大、分布模式复杂、健壮性下降、可靠性和性能下降，以及代码规模膨胀==等问题。

**表现层**：
- **MVC (Model-View-Controller)模式**：将应用程序的输入、处理和输出流程按照视图、控制和模型的方式进行分离。
- **MVP (Model-View-Presenter)模式**：从 MVC 模式演变而来，视图和模型之间不直接交互，而是通过 Presenter 进行。
- **MVVM (Model-View-ViewModel)模式**：为解决 MVP 中视图种类增多、接口增加的问题而提出，通过数据绑定实现视图和模型的双向绑定。

**中间层架构设计**：
- 采用 Domain Model-Service-Control 的思想，实现业务层的解耦和重用。
- Domain Model 表示领域对象，Service 实现业务逻辑，Control 负责服务之间的协调。

**数据访问层设计**：
- **数据访问模式**：包括在线访问模式、DAO 模式、DTO 模式、离线数据模式和对象/关系映射。
- **工厂模式在数据访问层的应用**：定义数据访问接口，根据不同数据库类型实例化相应的具体实现类。
- **ORM 设计思想**：在关系型数据库和对象之间建立映射，使用工具或平台将应用程序中的对象转换为关系型数据库中的记录。
- **事务处理**：事务应遵循 ACID 原则，即原子性、一致性、隔离性和持久性。
- **连接对象管理**：使用连接池模式进行优化，有效复用数据库连接，减少连接建立和关闭的开销。

**物联网层次架构设计**：
- **感知层**：用于识别物体、采集信息，包括传感器、RFID、摄像头等设备。
- **网络层**：用于传递信息和处理信息，包括通信网、互联网、网络管理中心等。
- **应用层**：实现广泛的行业智能化应用，包括应用程序层和终端设备层。

## 2 ※表现层

**MVC (Model-View-Controller) 模式**：
- **定义**：将应用程序的输入、处理和输出流程按照视图、控制和模型的方式进行分离。
- **组件**：
		- **视图 (View)**：负责界面显示。
		- **控制器 (Controller)**：接收用户输入并调用模型和视图。
		- **模型 (Model)**：封装业务逻辑。
- **优点**：
		- 允许多种用户界面扩展。
		- 易于维护。
		- 可以构建功能强大的用户界面。

**MVP (Model-View-Presenter) 模式**：
- **定义**：从 MVC 模式演变而来，包括模型、视图和控制器/呈现者三部分。
- **区别**：视图和模型之间不直接交互，而是通过 Presenter 进行。
- **优点**：
		- 模型与视图完全分离。
		- 可以更高效地使用模型。
		- 可以将一个 Presenter 用于多个视图。

**MVVM (Model-View-ViewModel) 模式**：
- **定义**：为解决 MVP 中视图种类增多、接口增加的问题而提出。
- **核心**：视图模型 ViewModel，通过数据绑定实现视图和模型的双向绑定。
- **优点**：更适用于数据驱动的场景，特别是数据操作频繁的场景。
- **缺点**：由于数据和视图的双向绑定，出现问题时不太好定位。

**表现层动态生成设计思想**：
- **界面定制模块**：用于定制界面。
- **界面动态生成模块**：根据配置动态生成界面。
- **DOM API**：用于操作文档对象模型。
- **界面配置模块**：管理界面配置。
- **数据存取类**：用于存取数据。
- **XML 配置文件**：存储界面配置信息。
- **数据库**：存储数据。

## 3 ※中间层架构设计

**Domain Model-Service-Control 思想**：采用 Domain Model-Service-Control 的思想，实现业务层的解耦和重用。这种架构提高了系统的灵活性和可扩展性。
- **Domain Model**：表示领域对象。
- **Service**：实现业务逻辑。
- **Control**：负责服务之间的协调。

**业务框架在整个系统架构中的位置**：
- **表示层**：包括 JSP、Servlet 和其他客户端，负责用户界面的展示和用户交互。
- **业务层**：包括 Domain Model、业务容器、Service 和 Control，负责实现业务逻辑。
- **数据访问层**：包括 DAO 界面和 DAO，负责数据访问和持久化。
- **数据库**：存储数据。

## 4 ※数据访问层设计

**数据访问模式**：
- **在线访问模式**：应用程序会一直保持与数据库的连接来进行数据操作。
- **DAO (Data Access Object) 模式**：将底层数据访问操作与高层业务逻辑分离，DAO 类包含访问特定数据源数据的具体逻辑。
- **DTO (Data Transfer Object) 模式**：用于跨进程或网络传输数据的对象容器，不包含业务逻辑。
- **离线数据模式**：数据从数据源获取后按预定义结构存放在系统中，与数据源连接或事务独立。
- **对象/关系映射**：提供工具或平台，将应用程序中的对象转换为关系型数据库中的记录，反之亦然。

**工厂模式在数据访问层的应用**：
- **定义**：定义一个数据访问接口，根据不同数据库类型实例化相应的具体实现类。
- **实现**：通过工厂类根据数据库类型返回合适的数据访问实现，实现了数据库无关性。

**ORM (Object-Relation Mapping) 设计思想**：
- **定义**：在关系型数据库和对象之间建立映射，应用程序可以像操作对象一样操作数据库。
- **优点**：大幅减少数据访问层的开发工作，专注于实现业务逻辑，通过缓存等机制优化性能，将数据库存储和业务层解耦。
- **示例**：Hibernate 是一个功能强大的 ORM 框架，可以自动完成从 Java 对象到数据库表的映射，提供对象化的数据访问接口，支持多种运行模式。

**事务处理**：
- **ACID 原则**：事务应该遵循原子性、一致性、隔离性和持久性。
- **事务处理方式**：J2EE 应用程序可以使用 ==JDBC 事务、JTA 事务和容器管理事务==等方式进行事务处理。

**连接对象管理**：
- **关键性能因素**：数据库连接管理是关键性能因素。
- **连接池模式**：使用连接池模式进行优化，连接池在系统初始化时分配连接，并提供灵活的连接分配和释放策略，有效复用数据库连接，减少连接建立和关闭的开销。

**物联网层次架构设计**：
- **感知层**：用于识别物体、采集信息，包括传感器、RFID、摄像头等设备。
- **网络层**：用于传递信息和处理信息，包括通信网、互联网、网络管理中心等。
- **应用层**：实现广泛的行业智能化应用，包括应用程序层和终端设备层。

## 5 ※架构案例

![IMG-F4308353856AAA19054FEED0A5CA2911.png](/img/user/00-%E7%B3%BB%E7%BB%9F%E6%96%87%E4%BB%B6/%E6%96%87%E6%A1%A3%E9%99%84%E4%BB%B6/04-%E7%9F%A5%E8%AF%86%E4%BB%93%E5%BA%93/%E7%9F%A5%E8%AF%86%E5%8D%95%E5%85%83/05-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%B8%88%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/14-%E5%B1%82%E6%AC%A1%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1-%E9%99%84%E4%BB%B6/IMG-F4308353856AAA19054FEED0A5CA2911.png)

**数据访问层的模块结构图**：
- **数据访问层的接口程序集 (IDAL)**：定义数据访问接口。
- **数据访问层需要使用的数据对象 (Model)**：持久层的持久对象，只有属性，没有行为。
- **创建 DAL 对象的工厂 (DALFactory)**：根据数据库类型返回合适的数据访问实现。
- **访问 Oracle 数据库的实现类 (OracleDAL)**：实现了 IDAL 的接口。
- **访问 MS SQL Server 数据库的实现类 (SQLServerDAL)**：实现了 IDAL 的接口。

![IMG-BB0E5CB4FEE7DCE10601B09E2EA12203.png](/img/user/00-%E7%B3%BB%E7%BB%9F%E6%96%87%E4%BB%B6/%E6%96%87%E6%A1%A3%E9%99%84%E4%BB%B6/04-%E7%9F%A5%E8%AF%86%E4%BB%93%E5%BA%93/%E7%9F%A5%E8%AF%86%E5%8D%95%E5%85%83/05-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%B8%88%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/14-%E5%B1%82%E6%AC%A1%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1-%E9%99%84%E4%BB%B6/IMG-BB0E5CB4FEE7DCE10601B09E2EA12203.png)

**电子小票物联网架构**：
- **感知层**：包括小票智能硬件，通过 WiFi/GPRS 采集并传输收银机待打印的小票信息。
- **网络层**：提供数据传输、处理、存储等基础服务，支持设备管理、商家管理等功能。
- **应用层**：包括向消费者提供电子小票实时推送、历史查询等服务，以及向商家提供经营数据分析、用户推荐等服务。

![IMG-1125B8828D3FD549B61045B209B38E75.png](/img/user/00-%E7%B3%BB%E7%BB%9F%E6%96%87%E4%BB%B6/%E6%96%87%E6%A1%A3%E9%99%84%E4%BB%B6/04-%E7%9F%A5%E8%AF%86%E4%BB%93%E5%BA%93/%E7%9F%A5%E8%AF%86%E5%8D%95%E5%85%83/05-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%B8%88%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/14-%E5%B1%82%E6%AC%A1%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1-%E9%99%84%E4%BB%B6/IMG-1125B8828D3FD549B61045B209B38E75.png)

**电子小票服务系统结构框图**：
- **小票智能硬件**：包括字模存储 Flash、无线模块、控制器等组件。
- **商家收银机**：待打印的购物小票。
- **电子小票云平台**：提供数据传输、处理、存储等基础服务。
- **微信公众平台**：向消费者推送电子小票。
- **消费者**：通过智能手机接收电子小票。
- **商家**：通过 PC 终端管理商家数据和电子小票。
